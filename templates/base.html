{% load static %}
{% load user_tags %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Jujutsu Infinite Values{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body class="d-flex flex-column min-vh-100 theme-dark">
<!-- Navigation -->
<nav class="main-navbar">
    <div class="nav-container">
        <div class="nav-brand">
            <a href="{% url 'values:landing' %}" class="brand-link">
                <span class="brand-icon">呪</span>
                <span class="brand-text">JJI Values</span>
            </a>
        </div>
        
        <button class="nav-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <div class="collapse navbar-collapse show" id="navMenu">
            <ul class="nav-menu">
                <li><a href="{% url 'values:item_list' %}" class="nav-link-item">Browse</a></li>
                <li><a href="{% url 'values:item_list' %}?category=weapons" class="nav-link-item">Weapons</a></li>
                <li><a href="{% url 'values:item_list' %}?category=armor" class="nav-link-item">Armor</a></li>
                <li><a href="{% url 'values:item_list' %}?category=titles" class="nav-link-item">Titles</a></li>
                <li><a href="{% url 'values:item_list' %}?category=cursed-objects" class="nav-link-item">Cursed Objects</a></li>
                <li class="nav-dropdown">
                    <a href="#" class="nav-link-item">More <i class="bi bi-chevron-down ms-1"></i></a>
                    <ul class="dropdown-menu-nav">
                        <li><a href="{% url 'values:item_list' %}?category=items">Items</a></li>
                        <li><a href="{% url 'values:item_list' %}?category=game-passes">Game Passes</a></li>
                        <li><a href="{% url 'values:item_list' %}?item_type=title">All Titles</a></li>
                        <li><a href="{% url 'values:item_list' %}?item_type=gamepass">All Game Passes</a></li>
                        <li><a href="{% url 'values:item_list' %}?item_type=event">Event Items</a></li>
                    </ul>
                </li>
                <li><a href="{% url 'values:trade_calculator' %}" class="nav-link-item">Calculator</a></li>
            </ul>
            
            <div class="nav-actions">
                {% if user.is_authenticated %}
                    {% if user.is_staff or user.is_superuser or user|is_value_reviewer %}
                        <div class="admin-menu">
                            <button class="btn-nav admin-btn">
                                <i class="bi bi-gear-fill"></i>
                                <span>Admin</span>
                                <i class="bi bi-chevron-down ms-1"></i>
                            </button>
                            <div class="admin-dropdown">
                                {% if user.is_staff %}
                                    <a href="{% url 'values:item_create' %}">
                                        <i class="bi bi-plus-circle"></i>
                                        <span>Create Item</span>
                                    </a>
                                    <a href="/admin/">
                                        <i class="bi bi-shield-lock"></i>
                                        <span>Django Admin</span>
                                    </a>
                                {% endif %}
                                {% if user.is_superuser %}
                                    <a href="{% url 'values:admin_value_requests' %}">
                                        <i class="bi bi-clipboard-check"></i>
                                        <span>Manage Value Requests</span>
                                    </a>
                                {% elif user|is_value_reviewer %}
                                    <a href="{% url 'values:value_requests' %}">
                                        <i class="bi bi-list-check"></i>
                                        <span>My Value Requests</span>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                    <div class="user-menu">
                        <button class="btn-nav user-btn">
                            {{ user.username }}
                        </button>
                        <div class="user-dropdown">
                            <a href="{% url 'values:profile' %}">Profile</a>
                            <a href="{% url 'values:logout' %}">Logout</a>
                        </div>
                    </div>
                {% else %}
                    <a href="{% url 'values:login' %}" class="btn-nav">
                        Login
                    </a>
                {% endif %}
                <button id="themeToggle" class="btn-nav theme-toggle">
                    <i class="bi bi-moon-fill"></i>
                </button>
            </div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="main-content flex-grow-1">
    {% block content %}{% endblock %}
</main>

<!-- Footer -->
<footer class="main-footer">
    <div class="footer-container">
        <div class="footer-content">
            <div class="footer-brand">
                <span class="brand-icon">呪</span>
                <span>JJI Values</span>
            </div>
            <p class="footer-text">Community-driven value reference for Jujutsu Infinite trades. Owned by Reythh</p>
        </div>
        <div class="footer-links">
            <a href="{% url 'values:item_list' %}">Browse Items</a>
            <a href="{% url 'values:trade_calculator' %}">Calculator</a>
            {% if user.is_staff %}<a href="/admin/">Admin</a>{% endif %}
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 JJI Values. All rights reserved.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Theme Toggle
    (function() {
        const body = document.body;
        const stored = localStorage.getItem('theme');
        if (stored === 'dark') body.classList.add('theme-dark');
        
        const btn = document.getElementById('themeToggle');
        if (!btn) return;
        
        function updateIcon() {
            const icon = btn.querySelector('i');
            icon.className = body.classList.contains('theme-dark') ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
        }
        
        btn.addEventListener('click', () => {
            body.classList.toggle('theme-dark');
            localStorage.setItem('theme', body.classList.contains('theme-dark') ? 'dark' : 'light');
            updateIcon();
        });
        
        updateIcon();
    })();
    
    // Dropdown menus
    document.querySelectorAll('.nav-dropdown').forEach(dropdown => {
        const link = dropdown.querySelector('.nav-link-item');
        link.addEventListener('click', (e) => {
            e.preventDefault();
            dropdown.classList.toggle('active');
        });
    });
    
    // User menu
    const userBtn = document.querySelector('.user-btn');
    if (userBtn) {
        userBtn.addEventListener('click', () => {
            document.querySelector('.user-menu').classList.toggle('active');
        });
    }
    
    // Admin menu
    const adminBtn = document.querySelector('.admin-btn');
    if (adminBtn) {
        adminBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            document.querySelector('.admin-menu').classList.toggle('active');
        });
    }
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.admin-menu')) {
            document.querySelectorAll('.admin-menu').forEach(menu => {
                menu.classList.remove('active');
            });
        }
        if (!e.target.closest('.user-menu')) {
            document.querySelectorAll('.user-menu').forEach(menu => {
                menu.classList.remove('active');
            });
        }
    });
</script>
{% block extra_js %}{% endblock %}
</body>
</html>
